CMAKE_MINIMUM_REQUIRED(VERSION 3.1)
# Unit Tests
# idea take from : http://mifrosu.blogspot.com.es/2013/02/cmake-and-google-test-framework.html


FILE(GLOB UNIT_TEST_FILES_SRC
  "*_test.cpp"
  )

FIND_PACKAGE(GTEST)
FIND_PACKAGE(GTEST_MAIN)
IF(NOT GTEST_FOUND)
  IF(DEFINED ENV{GTEST_ROOT})
    # FindGTEST could fail if gtest is not compiled
    ADD_SUBDIRECTORY($ENV{GTEST_ROOT} ${CMAKE_CURRENT_BINARY_DIR}/gtest)
  ELSE()
    MESSAGE(WARNING "You must have downloaded and unziped google test to tests/gtest-1.7.0")
    ADD_SUBDIRECTORY("gtest-1.7.0" ${CMAKE_CURRENT_BINARY_DIR}/gtest)
  ENDIF(DEFINED ENV{GTEST_ROOT})

  SET(GTEST_FOUND TRUE)
  SET(GTEST_INCLUDE_DIRS ${CMAKE_CURRENT_BINARY_DIR}/gtest)
  SET(GTEST_LIBRARIES libgtest )
  SET(GTEST_MAIN_LIBRARIES libgtest_main )
ENDIF(NOT GTEST_FOUND)

IF(GTEST_FOUND)
  FIND_PACKAGE(Threads REQUIRED)

SET(TEST_EXECUTABLE UNIT_TEST)

  INCLUDE_DIRECTORIES( UNIT_TEST
#    "${CMAKE_SOURCE_DIR}/src/"
#    "${CMAKE_SOURCE_DIR}/include/"
    "${CMAKE_SOURCE_DIR}/tests/"
    ${GTEST_INCLUDE_DIRS}
    )

  ADD_EXECUTABLE( UNIT_TEST
    ${UNIT_TEST_FILES_SRC}
#    ${TEC_SRC}
    ${TEC_INCLUDES}
#    ${IMGUI_SRC}
#    ${IMGUI_INCLUDES}
#    ${PB_FILES_SRC}
#    ${PB_FILES_INCLUDES}
    )

  SET_PROPERTY(TARGET UNIT_TEST PROPERTY CXX_STANDARD 11)
  TARGET_LINK_LIBRARIES( UNIT_TEST
    TEC_LIB
    ${TEC_ALL_LIBS}
    ${GTEST_LIBRARIES}
    ${GTEST_MAIN_LIBRARIES}
    ${CMAKE_THREAD_LIBS_INIT}
    )
ENDIF(GTEST_FOUND)
